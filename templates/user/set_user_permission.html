<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />
	<title>xxxxxxxxx |11111</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/style-metro.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/style.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/style-responsive.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
	<link href="/static/css/uniform.default.css" rel="stylesheet" type="text/css"/>
	<!-- END GLOBAL MANDATORY STYLES -->
	<!-- BEGIN PAGE LEVEL STYLES -->
	<link rel="stylesheet" type="text/css" href="/static/css/select2_metro.css" />
	<link rel="stylesheet" type="text/css" href="/static/css/chosen.css" />
	<!-- END PAGE LEVEL STYLES -->
	<link rel="shortcut icon" href="/static/image/favicon.ico" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed">
	<!-- BEGIN HEADER -->
	<div class="header navbar navbar-inverse navbar-fixed-top">
		<!-- BEGIN TOP NAVIGATION BAR -->
		<div class="navbar-inner">
			{% include "head.html" %}
		</div>
		<!-- END TOP NAVIGATION BAR -->
	</div>
	<!-- END HEADER -->
	<!-- BEGIN CONTAINER -->
	<div class="page-container row-fluid">
		<!-- BEGIN SIDEBAR -->
		{% include "navigation.html" %}
		<!-- END SIDEBAR -->
		<!-- BEGIN PAGE -->
		<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div id="portlet-config" class="modal hide">
				<div class="modal-header">
					<button data-dismiss="modal" class="close" type="button"></button>
					<h3>portlet Settings</h3>
				</div>
				<div class="modal-body">
					<p>Here will be a configuration form</p>
				</div>
			</div>
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN STYLE CUSTOMIZER -->
						<div class="color-panel hidden-phone">
							<div class="color-mode-icons icon-color"></div>
							<div class="color-mode-icons icon-color-close"></div>
							<div class="color-mode">
								<p>THEME COLOR</p>
								<ul class="inline">
									<li class="color-black current color-default" data-style="default"></li>
									<li class="color-blue" data-style="blue"></li>
									<li class="color-brown" data-style="brown"></li>
									<li class="color-purple" data-style="purple"></li>
									<li class="color-grey" data-style="grey"></li>
									<li class="color-white color-light" data-style="light"></li>
								</ul>
								<label>
									<span>Layout</span>
									<select class="layout-option m-wrap small">
										<option value="fluid" selected>Fluid</option>
										<option value="boxed">Boxed</option>
									</select>
								</label>
								<label>
									<span>Header</span>
									<select class="header-option m-wrap small">
										<option value="fixed" selected>Fixed</option>
										<option value="default">Default</option>
									</select>
								</label>
								<label>
									<span>Sidebar</span>
									<select class="sidebar-option m-wrap small">
										<option value="fixed">Fixed</option>
										<option value="default" selected>Default</option>
									</select>
								</label>
								<label>
									<span>Footer</span>
									<select class="footer-option m-wrap small">
										<option value="fixed">Fixed</option>
										<option value="default" selected>Default</option>
									</select>
								</label>
							</div>
						</div>
						<!-- END BEGIN STYLE CUSTOMIZER -->

						<ul class="breadcrumb">
							<li>
								<i class="icon-home"></i>
								<a href="{% url 'index' %}">首页</a>
								<span class="icon-angle-right"></span>
							</li>
							<li>
								<a href="#">用户权限设置</a>
								<span class="icon-angle-right"></span>
							</li>
						</ul>
					</div>
				</div>
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN VALIDATION STATES-->
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption"><i class="icon-reorder"></i>设置权限 </div>
								<div class="tools">
									<a href="javascript:;" class="collapse"></a>
									<a href="#portlet-config" data-toggle="modal" class="config"></a>
									<a href="javascript:;" class="reload"></a>
									<a href="javascript:;" class="remove"></a>
								</div>
							</div>
							<div class="portlet-body form">
								<!-- BEGIN FORM-->
								<table >
									<div class="control-group warning">
										<label class="control-label" for="inputWarning">用户名</label>
										<div class="controls">
											<input type="text" readonly required value="{{ username }}" placeholder="username" name="username" class="span2 m-wrap" id="username" />
										</div>
									</div>
                                    <div class="control-group warning">
										<label class="control-label" for="inputWarning">权限选择</label>
										<ul id="treeDemo" class="ztree"></ul>
									</div>


									<div>
										{% if exit_priv.change_permission == '0' %}	
											<button type="submit"  onclick="count_select()" class="btn blue">Save</button>{% csrf_token %}
										{% endif %}
										<button type="button" onclick="javascript:history.back(-1);" class="btn">Cancel</button>
									</div>
								</table>
								<!-- END FORM-->
						</div>
						<!-- END VALIDATION STATES-->
					</div>
				</div>

				<!-- END PAGE CONTENT-->
			</div>
			<!-- END PAGE CONTAINER-->
		</div>
		<!-- END PAGE -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	{% include "footer.html"%}
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->
	<script src="/static/js/jquery-1.10.1.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="/static/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
	<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
	<!--[if lt IE 9]>
	<script src="/static/js/excanvas.min.js"></script>
	<script src="/static/js/respond.min.js"></script>
	<![endif]-->
	<script src="/static/js/jquery.slimscroll.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery.blockui.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery.cookie.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery.uniform.min.js" type="text/javascript" ></script>
	<!-- END CORE PLUGINS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script type="text/javascript" src="/static/js/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/static/js/additional-methods.min.js"></script>
	<script type="text/javascript" src="/static/js/select2.min.js"></script>
	<script type="text/javascript" src="/static/js/chosen.jquery.min.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL STYLES -->
	<!--<script src="/static/js/app.js"></script>-->
	<script src="/static/js/form-validation.js"></script>
	<!-- END PAGE LEVEL STYLES -->
	<!--<script>-->
		<!--jQuery(document).ready(function() {-->
		   <!--// initiate layout and plugins-->
		   <!--&lt;!&ndash;App.init();&ndash;&gt;-->
		   <!--FormValidation.init();-->
		<!--});-->
	<!--</script>-->
	<!-- END JAVASCRIPTS -->
<script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-37564768-1']);  _gaq.push(['_setDomainName', 'keenthemes.com']);  _gaq.push(['_setAllowLinker', true]);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script></body>
<!-- END BODY -->
</html>
<link rel="stylesheet" href="/static/css/bootstrapStyle.css" type="text/css">

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="/static/js/jquery.ztree.excheck.js"></script>
<script type="text/javascript" src="/static/js/jquery.ztree.exedit.js"></script>
<SCRIPT type="text/javascript">
	<!--
	var setting = {
		view: {

			removeHoverDom: removeHoverDom,
			selectedMulti: false
		},
		check: {
			enable: true
		},
		data: {
			simpleData: {
				enable: true
			}
		},
	};
	var zNodes =[
	{id: 1, pId:0, name:"用户管理"},
		{id:10, pId:1, name:"用户列表"},
			{id:"scanf_user", pId:10, name:"查看", checked:false },
			{id:"add_user", pId:10, name:"新增", checked:false },
			{id:"change_user", pId:10, name:"修改", checked:false },
			{id:"delete_user", pId:10, name:"删除", checked:false },
		{id:11, pId:1, name:"用户组"},
			{id:"scanf_group", pId:11, name:"查看", checked:false },
			{id:"add_group", pId:11, name:"新增", checked:false },
			{id:"change_group", pId:11, name:"修改", checked:false },
			{id:"delete_group", pId:11, name:"删除", checked:false },

	{id:2, pId:0, name:"权限管理"},
		{id:20, pId:2, name:"权限分配"},
			{id:"scanf_permission", pId:20, name:"查看", checked:false },
			{id:"add_permission", pId:20, name:"新增", checked:false },
			{id:"change_permission", pId:20, name:"修改", checked:false },
			{id:"delete_permission", pId:20, name:"删除", checked:false },

	{id:3, pId:0, name:"资源信息"},
		{id:30, pId:3, name:"EC2"},
			{id:"scanf_ec2", pId:30, name:"查看", checked:false },
			{id:"add_ec2assetinfo", pId:30, name:"新增", checked:false },
			{id:"change_ec2assetinfo", pId:30, name:"修改", checked:false },
			{id:"delete_ec2assetinfo", pId:30, name:"删除", checked:false },
                {id:31, pId:3, name:"Alb"},
        		{id:"scanf_elbloadbalancers", pId:31, name:"查看", checked:false },
        	{id:32, pId:3, name:"Rds"},
            		{id:"scanf_rdsbasicinfo", pId:32, name:"查看", checked:false },

	{id:4, pId:0, name:"容器管理"},
		{id:42, pId:4, name:"环境"},
			{id:"scanf_containerenv", pId:42, name:"查看", checked:false },
			{id:"add_containerenv", pId:42, name:"新增", checked:false },
			{id:"change_containerenv", pId:42, name:"修改", checked:false },
			{id:"delete_containerenv", pId:42, name:"删除", checked:false },
		{id:41, pId:4, name:"环境组"},
			{id:"scanf_containerenvgroup", pId:41, name:"查看", checked:false },
			{id:"add_containerenvgroup", pId:41, name:"新增", checked:false },
			{id:"change_containerenvgroup", pId:41, name:"修改", checked:false },
			{id:"delete_containerenvgroup", pId:41, name:"删除", checked:false },
		{id:40, pId:4, name:"容器分布"},
			{id:"scanf_containerdist", pId:40, name:"查看", checked:false },
			{id:"add_containerdist", pId:40, name:"新增", checked:false },
			{id:"change_containerdist", pId:40, name:"修改", checked:false },
			{id:"delete_containerdist", pId:40, name:"删除", checked:false },

	    {id:100, pId:0, name:"Gitlab"},
        	{id:1000, pId:100, name:"代码提交"},
	            {id:"scanf_jenkinsbuild", pId:1000, name:"查看", checked:false },
        	    {id:"add_jenkinsbuild", pId:1000, name:"重试", checked:false },

	    {id:101, pId:0, name:"Jenkins"},
        	{id:1001, pId:101, name:"代码构建"},
	            {id:"scanf_usergitlabcommit", pId:1001, name:"查看", checked:false },

	
	{id:5, pId:0, name:"Harbor"},
		{id:50, pId:5, name:"项目"},
			{id:"scanf_projectinfo", pId:50, name:"查看", checked:false },
			{id:"add_projectinfo", pId:50, name:"新增", checked:false },
			{id:"change_projectinfo", pId:50, name:"修改", checked:false },
			{id:"delete_projectinfo", pId:50, name:"删除", checked:false },
		{id:51, pId:5, name:"镜像仓库"},
			{id:"scanf_warehouse", pId:51, name:"查看", checked:false },
			{id:"add_mirrorwarehouse", pId:51, name:"新增", checked:false },
			{id:"change_mirrorwarehouse", pId:51, name:"修改", checked:false },
			{id:"delete_mirrorwarehouse", pId:51, name:"删除", checked:false },
		{id:52, pId:5, name:"镜像标签"},
			{id:"scanf_mirrotag", pId:52, name:"查看", checked:false },
			{id:"add_mirrortags", pId:52, name:"新增", checked:false },
			{id:"change_mirrortags", pId:52, name:"修改", checked:false },
			{id:"delete_mirrortags", pId:52, name:"删除", checked:false },

	{id:6, pId:0, name:"发布管理"},
		{id:60, pId:6, name:"对比容器"},
			{id:"scanf_contrastresult", pId:60, name:"查看", checked:false },
			{id:"add_contrastresult", pId:60, name:"执行", checked:false },
			{id:"change_contrastresult", pId:60, name:"修改", checked:false },
			{id:"delete_contrastresult", pId:60, name:"删除", checked:false },
		{id:61, pId:6, name:"hosts列表"},
			{id:"scanf_hostinfo", pId:61, name:"查看", checked:false },
			{id:"add_hostsinfo", pId:61, name:"新增", checked:false },
			{id:"change_hostsinfo", pId:61, name:"修改", checked:false },
			{id:"delete_hostsinfo", pId:61, name:"删除", checked:false },
		{id:62, pId:6, name:"发布任务"},
			{id:"scanf_taskinfo", pId:62, name:"查看", checked:false },
			{id:"add_taskinfo", pId:62, name:"新增", checked:false },
			{id:"change_taskinfo", pId:62, name:"修改", checked:false },
			{id:"delete_taskinfo", pId:62, name:"删除", checked:false },
		{id:63, pId:6, name:"历史发布"},
			{id:"scanf_asyncrecord", pId:63, name:"查看", checked:false },
			{id:"add_asyncrecord", pId:63, name:"新增", checked:false },
			{id:"change_asyncrecord", pId:63, name:"修改", checked:false },
			{id:"delete_asyncrecord", pId:63, name:"删除", checked:false },

	{id:7, pId:0, name:"变更管理"},
		{id:70, pId:7, name:"变更申请"},
			{id:"scanf_changerecorder", pId:70, name:"查看", checked:false },
			{id:"add_changerecorder", pId:70, name:"执行", checked:false },
			{id:"change_changerecorder", pId:70, name:"修改", checked:false },
			{id:"delete_changerecorder", pId:70, name:"删除", checked:false },

	{id:9, pId:0, name:"工具管理"},
		{id:90, pId:9, name:"工具列表"},
			{id:"scanf_runcontainer", pId:90, name:"查看工具列表", checked:false },
			{id:"add_runcontainer", pId:90, name:"执行容器重启", checked:false },
			{id:"add_scriptgrouprelease", pId:90, name:"执行脚本组", checked:false },
		{id:91, pId:9, name:"脚本上传"},
			{id:"scanf_uploadfiles", pId:91, name:"查看", checked:false },
			{id:"add_uploadfiles", pId:91, name:"新增", checked:false },
			{id:"delete_uploadfiles", pId:91, name:"删除/下载", checked:false },
		{id:92, pId:9, name:"脚本封装"},
			{id:"scanf_scriptgroup", pId:92, name:"查看", checked:false },
			{id:"add_scriptgroup", pId:92, name:"新增", checked:false },
			{id:"change_scriptgroup", pId:92, name:"修改", checked:false },
			{id:"delete_scriptgroup", pId:92, name:"删除", checked:false },

	{id:8, pId:0, name:"审计管理"},
		{id:80, pId:8, name:"操作日志"},
			{id:"scanf_log", pId:80, name:"查看", checked:false },
		{id:81, pId:8, name:"登录日志"},
			{id:"scanf_loginrecorder", pId:81, name:"查看", checked:false },
        {id:84, pId:8, name:"异步日志"},
            {id:"scanf_asyncoperationaudit", pId:84, name:"查看", checked:false },
		{id:82, pId:8, name:"容器重启"},
			{id:"scanf_asyncfileinfo", pId:82, name:"查看", checked:false },
		{id:83, pId:8, name:"脚本日志"},
			{id:"scanf_scriptgrouprelease", pId:83, name:"查看", checked:false },
	];
	var checkList={{exit_group_priv|safe}};
	console.log(checkList)

	zNodes.forEach(function(item) {
		if (checkList.indexOf(item.id) >= 0) {
			item.checked = true;
			var p = item.pId;
			if ( p != 0 ){
				zNodes.forEach(function(item1){
					if (item1.id === p){
						item1.checked=true;
						var p1 = item1.pId;
						if ( p1 != 0 ){
							zNodes.forEach(function(item2){
								if (item2.id === p1){
									item2.checked=true;}
							})
						};
					};
				})
			}

			<!--console.log(item)-->
			<!--console.log(item.pId)-->
			<!--console.log("&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;checkList-&#45;&#45;&#45;&#45;")-->
		}
	})

	$(document).ready(function(){
		$.fn.zTree.init($("#treeDemo"), setting, zNodes);
	});
	var newCount = 1;
	function addHoverDom(treeId, treeNode) {
		var sObj = $("#" + treeNode.tId + "_span");
		if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
		var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
			+ "' title='add node' onfocus='this.blur();'></span>";
		sObj.after(addStr);
		var btn = $("#addBtn_"+treeNode.tId);
		if (btn) btn.bind("click", function(){
			var zTree = $.fn.zTree.getZTreeObj("treeDemo");
			zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
			return false;
		});
	};
	function removeHoverDom(treeId, treeNode) {
		$("#addBtn_"+treeNode.tId).unbind().remove();
	};
	function count_select(){
		var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
		var changenodes = treeObj.getChangeCheckedNodes();
		var nodes = treeObj.getChangeCheckedNodes();
		var nodes = treeObj.getCheckedNodes(true);
		var usern = document.getElementById("username").value;
		var permission = []
		for (var i=nodes.length;i>=1;i--){
			var tId = nodes[i-1].id;
			var pid = nodes[i-1].pId;
			if(typeof(tId) == 'string'){
				permission.push(tId);
			}
		}
		var dic = {};
		dic.permission = permission;
		dic.usern=usern;
		dic.csrfmiddlewaretoken =  '{{ csrf_token }}'
		console.log(dic);
		let url = '{% url 'ouser:set_user_p' %}'
		//let url = `http://54.254.216.210:8081/user/set_user_permission/`
		$.post(url,dic,function(res){
			console.log(res);
			if (res.msg === '200'){
				 location.href = res.url;
			}
		})
	}
	//-->
</SCRIPT>
